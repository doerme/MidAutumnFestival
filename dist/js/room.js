/*!
 * @project : MidAutumnFestival
 * @version : 0.0.1
 * @author  : 
 * @update  : 2017-09-30 10:12:40 pm
 */!function(t){function o(e){if(n[e])return n[e].exports;var i=n[e]={exports:{},id:e,loaded:!1};return t[e].call(i.exports,i,i.exports,o),i.loaded=!0,i.exports}var n={};return o.m=t,o.c=n,o.p="./js/",o(0)}([function(t,o,n){function e(t){return t&&t.__esModule?t:{"default":t}}var i=n(1),a=e(i);$(function(){var t={pageTpl:{roomunit:n(4)},buyNum:1,init:function o(){var t=this;t.bindEvent(),t.inRoom();var o={url:"ws://ws.czcycm.com:9588",callback:function n(o){"string"==typeof o&&(o=JSON.parse(o)),o.data&&o.data[0]&&t.talkUnitShow(o.data),console.log("ws cb",o)}};this.initSocket(o)},scrollBottom:function e(){var t=$(".js-room-main-list")[0].scrollHeight||$(".js-room-main-list")[0].scrollHeight;$(".js-room-main-list").scrollTop(t)},talkUnitShow:function i(t){var o=this,n=0;t&&t[0].delay&&(n=1e3*t[0].delay),console.log("delay",n),setTimeout(function(){$(".js-room-main-list").append(o.pageTpl.roomunit({data:t[0]})),setTimeout(function(){o.scrollBottom()},200),o.scrollBottom()},n)},inRoom:function r(){var t=this;$.ajax({url:"http://www.czcycm.com/app/hb/jiaru_room",type:"post",data:{room_id:window.location.href.match(/roomid=(\d+)/)[1]}}).done(function(o){"string"==typeof o&&(o=JSON.parse(o)),1==o.code&&1==o.data.type?($(".js-room-main-list").removeClass("hide"),t.getRoomMsg()):(t.pageToast("加入房间失败，请重试"),t.roomTuichu(),setTimeout(function(){window.history.back(-1)},2e3)),console.log(o)})},getRoomMsg:function s(){var t=this;$.ajax({url:"http://www.czcycm.com/app/hb/my_info",type:"post"}).done(function(o){"string"==typeof o&&(o=JSON.parse(o)),1==o.code?($(".js-room-total-num").html(o.data.je),1==o.data.is_inroom?$(".bt-tuichu").removeClass("hide"):$(".bt-jiaru").removeClass("hide")):t.pageToast("获取个人信息失败"),console.log(o)})},sendIMMessage:function c(){var t=this;return""==$.trim($(".js-main-input").val())?void t.pageToast("发送消息不能为空"):void $.ajax({url:"http://www.czcycm.com/app/hb/send_text",type:"post",data:{text:$(".js-main-input").val()}}).done(function(o){"string"==typeof o&&(o=JSON.parse(o)),1==o.code?($(".js-main-input").val(""),t.scrollBottom()):t.pageToast("消息发送失败请重试")})},roomTuichu:function l(){var t=this;$.ajax({url:"http://www.czcycm.com/app/hb/tuichu_room",type:"post"}).done(function(o){"string"==typeof o&&(o=JSON.parse(o)),1==o.code?window.history.back(-1):t.pageToast("退出房间失败")}).fail(function(o){t.pageToast("退出房间失败")})},openRedPc:function u(t,o,n){$(".js-redrp-open-avatar").attr({src:o}),$(".js-redrp-open-nickname").html(n),$.ajax({url:"http://www.czcycm.com/app/hb/hb_info/"+t,type:"post"}).done(function(t){"string"==typeof t&&(t=JSON.parse(t)),$(".toast-window-redpc").removeClass("null"),0==t.data.je&&$(".toast-window-redpc").addClass("null"),$(".js-redrp-open-msg").html(t.data.msg),$(".js-redrp-open").removeClass("hide"),$(".js-flrp-avatar").attr({src:o}),$(".js-flrp-name").html(n+"的红包"),$(".js-flrp-note").html(t.data.msg),$(".js-flrp-money").html(t.data.je+"<span>元</span>")})},bindEvent:function d(){var t=this;$(".js-main-input").on("focus",function(){setTimeout(function(){document.body.scrollTop=document.body.scrollHeight,t.scrollBottom()},500)}),$(".js-emit-bt").on("click",function(){t.sendIMMessage()}),$(".bt-dating").on("click",function(){window.history.back(-1)}),$(".bt-jiaru").on("click",function(){t.inRoom()}),$(".bt-tuichu").on("click",function(){t.roomTuichu()}),$(".js-open-redpc").on("click",function(){$(".js-redrp-open").removeClass("hide")}),$(".toast-window-redpc").on("click",function(){$(".js-redrp-open").addClass("hide"),$(".js-redpc-rs").removeClass("hide")}),$(".toast-window-mask").on("click",function(){$(this).parent(".toast-window").addClass("hide")}),$(".twn-t-close, .js-win-close").on("click",function(){$(this).parents(".toast-window").addClass("hide")}),$(".rrw-close").on("click",function(){$(".js-redpc-rs").addClass("hide")}),$(".js-room-main-list").on("click",".js-open-redpc",function(){t.openRedPc($(this).data("id"),$(this).data("headimgurl"),$(this).data("nickname"))})},pageToast:function p(t){$(".main-toast-window").html(t).removeClass("hide"),setTimeout(function(){$(".main-toast-window").addClass("hide")},1800)},initSocket:function m(t){var o=window.location,n=t.url?t.url:"ws://"+o.hostname+":"+o.port+_get_basepath()+"/websocket",e=t.callback;if("function"!=typeof e)return console.log("callback 必须为函数"),!1;var i=new ReconnectingWebSocket(n);return i.onerror=function(){console.log("websocket.error")},i.onopen=function(t){console.log("onopen");var o={cmd:"login",gid:window.location.href.match(/roomid=(\d+)/)[1]};i.send((0,a["default"])(o))},i.onmessage=function(t){e(t.data)},i.onclose=function(){i.close(),console.log("websocket.onclose")},window.onbeforeunload=function(){i.close()},i}};t.init()})},function(t,o,n){t.exports={"default":n(2),__esModule:!0}},function(t,o,n){var e=n(3),i=e.JSON||(e.JSON={stringify:JSON.stringify});t.exports=function a(t){return i.stringify.apply(i,arguments)}},function(t,o){var n=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=n)},function(t,o,n){var e=n(5);t.exports=e("6d574b90-a5e9-11e7-ad96-9fad48674047",function(t,o){"use strict";var n=this,e=n.$helpers,i=t.data,a=n.$escape,r="";return"text"==i.type?(r+=' <li> <img class="user-avatar" src="',r+=a(i.headimgurl),r+='" /> <div class="content-wrap"> <div class="user-name">',r+=a(i.nickname),r+='</div> <div class="user-msg">',r+=a(i.text),r+="</div> </div> </li> "):"hb"==i.type?(r+=' <li> <img class="user-avatar" src="',r+=a(i.headimgurl),r+='" /> <div class="content-wrap"> <div class="user-name">大安大厦</div> <div class="user-redpc js-open-redpc" data-id="',r+=a(i.hb_id),r+='" data-headimgurl="',r+=a(i.headimgurl),r+='" data-nickname="',r+=a(i.nickname),r+='"> <div class="ur-title">红包</div> <div class="ur-note">红包未领取</div> <div class="ur-bottom">微信红包</div> </div> </div> </li> '):"ts"==i.type&&(r+=' <li class="ts"><span class="ts-show">',r+=a(i.text),r+="</span></li> "),r+=" ",new String(r)})},function(t,o){!function(){function o(t,o){return(/string|function/.test(typeof o)?c:s)(t,o)}function n(t,o){return"string"!=typeof t&&(o=typeof t,"number"===o?t+="":t="function"===o?n(t.call(t)):""),t}function e(t){return p[t]}function i(t){return n(t).replace(/&(?![\w#]+;)|[<>"']/g,e)}function a(t,o){if(m(t))for(var n=0,e=t.length;e>n;n++)o.call(t,t[n],n,t);else for(n in t)o.call(t,t[n],n)}function r(t,o){var n=/(\/)[^\/]+\1\.\.\1/,e=("./"+t).replace(/[^\/]+$/,""),i=e+o;for(i=i.replace(/\/\.\//g,"/");i.match(n);)i=i.replace(n,"/");return i}function s(t,n){var e=o.get(t)||l({filename:t,name:"Render Error",message:"Template not found"});return n?e(n):e}function c(t,o){if("string"==typeof o){var n=o;o=function(){return new d(n)}}var e=u[t]=function(n){try{return new o(n,t)+""}catch(e){return l(e)()}};return e.prototype=o.prototype=f,e.toString=function(){return o+""},e}function l(t){var o="{Template Error}",n=t.stack||"";if(n)n=n.split("\n").slice(0,2).join("\n");else for(var e in t)n+="<"+e+">\n"+t[e]+"\n\n";return function(){return"object"==typeof console&&console.error(o+"\n\n"+n),o}}var u=o.cache={},d=this.String,p={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},m=Array.isArray||function(t){return"[object Array]"==={}.toString.call(t)},f=o.utils={$helpers:{},$include:function(t,o,n){return t=r(n,t),s(t,o)},$string:n,$escape:i,$each:a},h=o.helpers=f.$helpers;o.get=function(t){return u[t.replace(/^\.\//,"")]},o.helper=function(t,o){h[t]=o},t.exports=o}()}]);