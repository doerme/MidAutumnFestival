/*!
 * @project : MidAutumnFestival
 * @version : 0.0.1
 * @author  : 
 * @update  : 2017-10-10 10:02:52 pm
 */!function(t){function o(n){if(e[n])return e[n].exports;var i=e[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,o),i.loaded=!0,i.exports}var e={};return o.m=t,o.c=e,o.p="./js/",o(0)}([function(t,o,e){function n(t){return t&&t.__esModule?t:{"default":t}}var i=e(1),a=n(i);$(function(){var t={pageTpl:{roomunit:e(4)},buyNum:1,titlenm:"",mid:null,hadws:!1,getRedpocket:null,init:function o(){if(null==window.location.href.match(/roomid=(\d+)/))return console.log("没有房间号"),void(window.location.href="/");var t=this;t.bindEvent(),t.inRoom(),t.sharecode()},beginWS:function n(){var t=this;if(!t.hadws){t.hadws=!0,t.wsmid=t.mid;var o={url:"ws://ws.czcycm.com:9588",callback:function e(o){"string"==typeof o&&(o=JSON.parse(o)),o.data&&o.data[0]&&t.talkUnitShow(o.data),console.log("ws cb",o)}};t.initSocket(o)}},sharecode:function i(){console.log("aaaa");var t=this,o="http://www.czcycm.com/app/wallet/room?roomid="+window.location.href.match(/roomid=(\d+)/)[1],e="http://www.czcycm.com/mex/mid/img/page/WechatIMG2.png",n=t.titlenm+"给你送了6.66元的现金红包";desc="可以立即提现哦";var i=window.location.href;$.ajax({type:"POST",url:"http://www.czcycm.com/common/jsapi",dataType:"json",data:{url:i},success:function a(t){console.log("tttttt"+t.appId),wx.config({debug:!1,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"]}),wx.ready(function(){wx.onMenuShareTimeline({link:o,imgUrl:e}),wx.onMenuShareAppMessage({title:n,desc:desc,link:o,imgUrl:e})})}})},scrollBottom:function r(){var t=$(".js-room-main-list")[0].scrollHeight||$(".js-room-main-list")[0].scrollHeight;$(".js-room-main-list").scrollTop(t)},talkUnitShow:function c(t){var o=this,e=t[0];setTimeout(function(){$(".js-room-main-list").append(o.pageTpl.roomunit({data:e})),setTimeout(function(){o.scrollBottom()},200),o.scrollBottom(),o.getRoomMsg()},1e3*Number(e.delay))},inRoom:function s(){var t=this;$.ajax({url:"http://www.czcycm.com/app/hb/jiaru_room",type:"post",data:{room_id:window.location.href.match(/roomid=(\d+)/)[1]}}).done(function(o){"string"==typeof o&&(o=JSON.parse(o)),1==o.code?1==o.data.type?($(".js-room-main-list").removeClass("hide"),$(".bt-tuichu").show(),$(".bt-jiaru").hide(),t.getRoomMsg(),t.getRoomHB(),$.ajax({url:"http://www.czcycm.com/app/hb/send_text",type:"post",data:{text:"大家好，我来了"}})):(t.pageToast(o.data.msg),setTimeout(function(){5==o.data.type||(1==o.data.type?window.location.href="/":3==o.data.type&&$(".bt-tuichu").removeClass("hide"))},3800)):($(".bt-tuichu").addClass("hide"),$(".bt-jiaru").removeClass("hide")),console.log(o)})},getRoomHB:function d(){var t=this;$.ajax({url:"http://www.czcycm.com/app/hb/get_hb",type:"post",data:{room_id:window.location.href.match(/roomid=(\d+)/)[1]}}).done(function(o){"string"==typeof o&&(o=JSON.parse(o)),1==o.code&&$(".js-room-main-list").append(t.pageTpl.roomunit({data:{type:"hb",nickname:o.data.nickname,headimgurl:o.data.headimgurl,hb_id:o.data.hb_id,firstdata:"1"}}))})},getRoomMsg:function l(){var t=this;$.ajax({url:"http://www.czcycm.com/app/hb/my_info",type:"post",data:{room_id:window.location.href.match(/roomid=(\d+)/)[1]}}).done(function(o){"string"==typeof o&&(o=JSON.parse(o)),1==o.code?($(".room-total-num").html(o.data.je),t.mid=o.data.mid,t.beginWS(),document.title=o.data.room_name,t.titlenm=o.data.room_name,1==o.data.is_inroom?$(".bt-tuichu").removeClass("hide"):$(".bt-jiaru").removeClass("hide")):t.pageToast("获取个人信息失败"),console.log(o)})},sendIMMessage:function u(){var t=this;return""==$.trim($(".js-main-input").val())?void t.pageToast("发送消息不能为空"):void $.ajax({url:"http://www.czcycm.com/app/hb/send_text",type:"post",data:{text:$(".js-main-input").val()}}).done(function(o){"string"==typeof o&&(o=JSON.parse(o)),1==o.code?($(".js-main-input").val(""),t.scrollBottom()):t.pageToast("消息发送失败请重试")})},openRedpocket:function p(t){var o=this;$.ajax({url:"http://www.czcycm.com/app/hb/hb_info/"+t,type:"get"}).done(function(t){"string"==typeof t&&(t=JSON.parse(t),console.log(t),$(".js-redrp-open-msgvalue").html(t.data.msg||"恭喜发财，大吉大利"),0==t.data.je?($(".js-no-redpocket .red-name").html(t.data.nickname),$(".js-no-redpocket img").attr("src",t.data.headimgurl),$(".js-no-redpocket").removeClass("hide")):(o.getRedpocket=t.data,$(".js-redrp-open .red-name").html(t.data.nickname),$(".js-redrp-open img").attr("src",t.data.headimgurl),$(".js-redrp-open").removeClass("hide")))}).fail(function(t){console.log("err: ",t)})},roomTuichu:function m(){var t=this;$.ajax({url:"http://www.czcycm.com/app/hb/tuichu_room",type:"post"}).done(function(o){"string"==typeof o&&(o=JSON.parse(o)),1==o.code?window.location.href="/":t.pageToast("退出房间失败")}).fail(function(o){t.pageToast("退出房间失败")})},bindEvent:function f(){var t=this;$(".js-main-input").on("focus",function(){setTimeout(function(){document.body.scrollTop=document.body.scrollHeight,t.scrollBottom()},500)}),$(".js-emit-bt").on("click",function(){t.sendIMMessage()}),$(".bt-dating").on("click",function(){window.location.href="http://www.czcycm.com/app/wallet/roomlist"}),$(".bt-jiaru").on("click",function(){t.inRoom()}),$(".bt-tuichu").on("click",function(){t.roomTuichu()}),$(".js-room-main-list").on("click",".js-redpocket-item",function(){if(!$(this).find(".user-redpc").hasClass("done")){var o=$(this).data("id");t.openRedpocket(o),$(this).data("oneclick")&&($(this).find(".user-redpc").addClass("done"),$(this).find(".ur-note").html("红包已领取"))}}),$(".js-redrp-open .toast-window-redpc").on("click",function(){$(".js-redrp-open").addClass("hide"),$(".js-redpc-rs .rrw-avatar").attr("src",t.getRedpocket.headimgurl),$(".js-redpc-rs .rrw-name").html(t.getRedpocket.nickname+"的红包"),$(".js-redpc-rs .rrw-money").text(t.getRedpocket.je),$(".js-redpc-rs").removeClass("hide")}),$(".toast-window-mask").on("click",function(){t.getRedpocket=null,$(this).parent(".toast-window").addClass("hide")}),$(".twn-t-close, .js-win-close").on("click",function(){$(this).parents(".toast-window").addClass("hide")}),$(".rrw-close").on("click",function(){t.getRedpocket=null,$(".js-redpc-rs").addClass("hide")}),$(".bt-toshare").on("click",function(){$(".guide-box").removeClass("hide")}),$(".guide-box").on("click",function(){$(".guide-box").addClass("hide")})},pageToast:function h(t){$(".main-toast-window").html(t).removeClass("hide"),setTimeout(function(){$(".main-toast-window").addClass("hide")},3800)},initSocket:function g(t){var o=this,e=window.location,n=t.url?t.url:"ws://"+e.hostname+":"+e.port+_get_basepath()+"/websocket",i=t.callback;if("function"!=typeof i)return console.log("callback 必须为函数"),!1;var r=new ReconnectingWebSocket(n);return r.onerror=function(){console.log("websocket.error")},r.onopen=function(t){console.log("onopen");var e={cmd:"login",gid:window.location.href.match(/roomid=(\d+)/)[1],mid:o.mid};r.send((0,a["default"])(e))},r.onmessage=function(t){i(t.data)},r.onclose=function(){r.close(),console.log("websocket.onclose")},window.onbeforeunload=function(){r.close()},r}};t.init()})},function(t,o,e){t.exports={"default":e(2),__esModule:!0}},function(t,o,e){var n=e(3),i=n.JSON||(n.JSON={stringify:JSON.stringify});t.exports=function a(t){return i.stringify.apply(i,arguments)}},function(t,o){var e=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=e)},function(t,o,e){var n=e(5);t.exports=n("b703d880-adc3-11e7-bd68-935ffffafd18",function(t,o){"use strict";var e=this,n=e.$helpers,i=t.data,a=e.$escape,r=e.$string,c="";return"text"==i.type?(c+=' <li> <img class="user-avatar" src="',c+=a(i.headimgurl),c+='" /> <div class="content-wrap"> <div class="user-name">',c+=a(i.nickname),c+='</div> <div class="user-msg">',c+=r(i.text),c+="</div> </div> </li> "):"hb"==i.type?(c+=' <li class="js-redpocket-item" data-id="',c+=a(i.hb_id),c+='" data-oneclick="',c+=a(i.firstdata),c+='"> <img class="user-avatar" src="',c+=a(i.headimgurl),c+='" /> <div class="content-wrap"> <div class="user-name">',c+=a(i.nickname),c+='</div> <div class="user-redpc js-open-redpc" data-id="',c+=a(i.hb_id),c+='" data-headimgurl="',c+=a(i.headimgurl),c+='" data-nickname="',c+=a(i.nickname),c+='"> <div class="ur-title">红包</div> <div class="ur-note">红包未领取</div> <div class="ur-bottom">微信红包</div> </div> </div> </li> '):"ts"==i.type&&(c+=' <li class="ts"><span class="ts-show">',c+=a(i.text),c+="</span></li> "),c+=" ",new String(c)})},function(t,o){!function(){function o(t,o){return(/string|function/.test(typeof o)?s:c)(t,o)}function e(t,o){return"string"!=typeof t&&(o=typeof t,"number"===o?t+="":t="function"===o?e(t.call(t)):""),t}function n(t){return p[t]}function i(t){return e(t).replace(/&(?![\w#]+;)|[<>"']/g,n)}function a(t,o){if(m(t))for(var e=0,n=t.length;n>e;e++)o.call(t,t[e],e,t);else for(e in t)o.call(t,t[e],e)}function r(t,o){var e=/(\/)[^\/]+\1\.\.\1/,n=("./"+t).replace(/[^\/]+$/,""),i=n+o;for(i=i.replace(/\/\.\//g,"/");i.match(e);)i=i.replace(e,"/");return i}function c(t,e){var n=o.get(t)||d({filename:t,name:"Render Error",message:"Template not found"});return e?n(e):n}function s(t,o){if("string"==typeof o){var e=o;o=function(){return new u(e)}}var n=l[t]=function(e){try{return new o(e,t)+""}catch(n){return d(n)()}};return n.prototype=o.prototype=f,n.toString=function(){return o+""},n}function d(t){var o="{Template Error}",e=t.stack||"";if(e)e=e.split("\n").slice(0,2).join("\n");else for(var n in t)e+="<"+n+">\n"+t[n]+"\n\n";return function(){return"object"==typeof console&&console.error(o+"\n\n"+e),o}}var l=o.cache={},u=this.String,p={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},m=Array.isArray||function(t){return"[object Array]"==={}.toString.call(t)},f=o.utils={$helpers:{},$include:function(t,o,e){return t=r(e,t),c(t,o)},$string:e,$escape:i,$each:a},h=o.helpers=f.$helpers;o.get=function(t){return l[t.replace(/^\.\//,"")]},o.helper=function(t,o){h[t]=o},t.exports=o}()}]);