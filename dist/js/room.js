/*!
 * @project : MidAutumnFestival
 * @version : 0.0.1
 * @author  : 
 * @update  : 2017-09-30 7:06:07 pm
 */!function(n){function t(e){if(o[e])return o[e].exports;var i=o[e]={exports:{},id:e,loaded:!1};return n[e].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var o={};return t.m=n,t.c=o,t.p="./js/",t(0)}([function(n,t,o){function e(n){return n&&n.__esModule?n:{"default":n}}var i=o(1),r=e(i);$(function(){var n={pageTpl:{roomunit:o(4)},buyNum:1,init:function(){var n=this;n.bindEvent(),n.inRoom();var t={url:"ws://ws.czcycm.com:9588",callback:function(t){"string"==typeof t&&(t=JSON.parse(t)),t.data&&t.data[0]&&n.talkUnitShow(t.data),console.log("ws cb",t)}};this.initSocket(t)},talkUnitShow:function(n){var t=this;$(".js-room-main-list").append(t.pageTpl.roomunit({data:n[0]}))},inRoom:function(){var n=this;$.ajax({url:"http://www.czcycm.com/app/hb/jiaru_room",type:"post",data:{room_id:window.location.href.match(/roomid=(\d+)/)[1]}}).done(function(t){"string"==typeof t&&(t=JSON.parse(t)),1==t.code?($(".js-room-main-list").removeClass("hide"),n.getRoomMsg()):confirm("加入房间失败，请重试")&&window.history.back(-1),console.log(t)})},getRoomMsg:function(){var n=this;$.ajax({url:"http://www.czcycm.com/app/hb/my_info",type:"post"}).done(function(t){"string"==typeof t&&(t=JSON.parse(t)),1==t.code?($(".js-room-total-num").html(t.data.je),1==t.data.is_inroom?$(".bt-tuichu").removeClass("hide"):$(".bt-jiaru").removeClass("hide")):n.pageToast("获取个人信息失败"),console.log(t)})},sendIMMessage:function(){var n=this;return""==$.trim($(".js-main-input").val())?void n.pageToast("发送消息不能为空"):void $.ajax({url:"http://www.czcycm.com/app/hb/send_text",type:"post",data:{text:$(".js-main-input").val()}}).done(function(t){"string"==typeof t&&(t=JSON.parse(t)),1==t.code?$(".js-main-input").val(""):n.pageToast("消息发送失败请重试")})},roomTuichu:function(){var n=this;$.ajax({url:"http://www.czcycm.com/app/hb/tuichu_room",type:"post"}).done(function(t){"string"==typeof t&&(t=JSON.parse(t)),1==t.code?window.history.back(-1):n.pageToast("退出房间失败")}).fail(function(t){n.pageToast("退出房间失败")})},bindEvent:function(){var n=this;$(".js-emit-bt").on("click",function(){n.sendIMMessage()}),$(".bt-dating").on("click",function(){window.history.back(-1)}),$(".bt-jiaru").on("click",function(){}),$(".bt-tuichu").on("click",function(){n.roomTuichu()}),$(".js-open-redpc").on("click",function(){$(".js-redrp-open").removeClass("hide")}),$(".toast-window-redpc").on("click",function(){$(".js-redrp-open").addClass("hide"),$(".js-redpc-rs").removeClass("hide")}),$(".toast-window-mask").on("click",function(){$(this).parent(".toast-window").addClass("hide")}),$(".twn-t-close, .js-win-close").on("click",function(){$(this).parents(".toast-window").addClass("hide")}),$(".rrw-close").on("click",function(){$(".js-redpc-rs").addClass("hide")})},pageToast:function(n){$(".main-toast-window").html(n).removeClass("hide"),setTimeout(function(){$(".main-toast-window").addClass("hide")},1800)},initSocket:function(n){var t=window.location,o=n.url?n.url:"ws://"+t.hostname+":"+t.port+_get_basepath()+"/websocket",e=n.callback;if("function"!=typeof e)return console.log("callback 必须为函数"),!1;var i=new ReconnectingWebSocket(o);return i.onerror=function(){console.log("websocket.error")},i.onopen=function(n){console.log("onopen");var t={cmd:"login",gid:window.location.href.match(/roomid=(\d+)/)[1]};i.send((0,r["default"])(t))},i.onmessage=function(n){e(n.data)},i.onclose=function(){i.close(),console.log("websocket.onclose")},window.onbeforeunload=function(){i.close()},i}};n.init()})},function(n,t,o){n.exports={"default":o(2),__esModule:!0}},function(n,t,o){var e=o(3),i=e.JSON||(e.JSON={stringify:JSON.stringify});n.exports=function(n){return i.stringify.apply(i,arguments)}},function(n,t){var o=n.exports={version:"2.4.0"};"number"==typeof __e&&(__e=o)},function(n,t,o){var e=o(5);n.exports=e("/Users/xiaominghari/Documents/wanrenqun/MidAutumnFestival/MidAutumnFestival/src/js/tpl/roomunit",function(n,t){"use strict";var o=this,e=(o.$helpers,n.data),i=o.$escape,r="";return"text"==e.type&&(r+=' <li> <img class="user-avatar" src="',r+=i(e.headimgurl),r+='" /> <div class="content-wrap"> <div class="user-name">',r+=i(e.nickname),r+='</div> <div class="user-msg">',r+=i(e.text),r+="</div> </div> </li> "),r+=" ",new String(r)})},function(n,t){!function(){function t(n,t){return(/string|function/.test(typeof t)?s:c)(n,t)}function o(n,t){return"string"!=typeof n&&(t=typeof n,"number"===t?n+="":n="function"===t?o(n.call(n)):""),n}function e(n){return d[n]}function i(n){return o(n).replace(/&(?![\w#]+;)|[<>"']/g,e)}function r(n,t){if(f(n))for(var o=0,e=n.length;e>o;o++)t.call(n,n[o],o,n);else for(o in n)t.call(n,n[o],o)}function a(n,t){var o=/(\/)[^\/]+\1\.\.\1/,e=("./"+n).replace(/[^\/]+$/,""),i=e+t;for(i=i.replace(/\/\.\//g,"/");i.match(o);)i=i.replace(o,"/");return i}function c(n,o){var e=t.get(n)||u({filename:n,name:"Render Error",message:"Template not found"});return o?e(o):e}function s(n,t){if("string"==typeof t){var o=t;t=function(){return new p(o)}}var e=l[n]=function(o){try{return new t(o,n)+""}catch(e){return u(e)()}};return e.prototype=t.prototype=m,e.toString=function(){return t+""},e}function u(n){var t="{Template Error}",o=n.stack||"";if(o)o=o.split("\n").slice(0,2).join("\n");else for(var e in n)o+="<"+e+">\n"+n[e]+"\n\n";return function(){return"object"==typeof console&&console.error(t+"\n\n"+o),t}}var l=t.cache={},p=this.String,d={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},f=Array.isArray||function(n){return"[object Array]"==={}.toString.call(n)},m=t.utils={$helpers:{},$include:function(n,t,o){return n=a(o,n),c(n,t)},$string:o,$escape:i,$each:r},h=t.helpers=m.$helpers;t.get=function(n){return l[n.replace(/^\.\//,"")]},t.helper=function(n,t){h[n]=t},n.exports=t}()}]);